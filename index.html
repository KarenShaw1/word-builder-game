<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto-Advancing Typing Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .text-display {
            font-size: 1.5rem;
            line-height: 2.25rem;
            min-height: 90px; /* Ensure consistent height */
        }
        .correct { color: #10b981; } /* Emerald 500 */
        .incorrect { color: #ef4444; } /* Red 500 */
        .current {
            background-color: #d1d5db; /* Gray 300 */
            border-radius: 0.25rem;
            padding: 2px 4px;
        }
        .letter.incorrect-letter {
            color: #ef4444;
            text-decoration: underline;
            text-decoration-color: #ef4444;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .word-result-label {
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            color: white;
            font-size: 0.875rem;
        }
        .word-correct { background-color: #10b981; }
        .word-incorrect { background-color: #f97316; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app" class="w-full max-w-3xl bg-white p-8 md:p-12 shadow-2xl rounded-xl">
        <h1 class="text-4xl font-bold text-center mb-6 text-gray-800">Typing Accuracy Practice</h1>

        <!-- Typing Interface -->
        <div id="typing-interface">
            <div id="text-display" class="text-display mb-8 p-4 bg-gray-100 rounded-lg shadow-inner select-none text-gray-600">
                <!-- Words will be rendered here -->
            </div>

            <input
                type="text"
                id="input-field"
                class="w-full p-4 text-xl border-4 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none transition duration-150 shadow-md"
                placeholder="Start typing the word above... (Press Space to advance)"
                autocomplete="off"
            />

            <button id="restart-button" class="w-full mt-6 py-3 px-6 bg-indigo-600 text-white font-semibold rounded-lg shadow-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50">
                Restart Test
            </button>
        </div>

        <!-- Results Interface (Hidden initially) -->
        <div id="results-interface" class="hidden text-center">
            <!-- Dynamic final message based on score -->
            <h2 id="final-message" class="text-3xl font-extrabold mb-4">
                Test Complete!
            </h2>
            
            <div class="bg-indigo-50 p-6 rounded-lg mb-8 shadow-md">
                <p class="text-lg text-gray-700">You completed <span id="total-words"></span> words.</p>
                <p class="text-5xl font-extrabold text-gray-800 mt-2">
                    <span id="correct-count" class="text-green-600">0</span> / <span id="total-count-display">0</span>
                </p>
                <p class="text-xl font-medium text-gray-600 mt-1">Words Correct</p>
            </div>

            <h3 class="text-2xl font-semibold mb-4 text-gray-800 border-b pb-2">Word-by-Word Breakdown</h3>
            <div id="results-breakdown" class="max-h-96 overflow-y-auto text-left px-4">
                <!-- Detailed results go here -->
            </div>

            <button id="restart-button-results" class="w-full mt-8 py-3 px-6 bg-indigo-600 text-white font-semibold rounded-lg shadow-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50">
                Start New Test
            </button>
        </div>

    </div>

    <script>
        // --- Configuration and State ---
        const WORDS = [
            "the", "quick", "brown", "fox", "jumps", "over", "the", "lazy", "dog", "swiftly",
            "keyboard", "programming", "javascript", "developer", "interface", "monitor", "application",
            "algorithm", "function", "variable", "boolean", "integer", "string", "context", "promise",
            "asynchronous", "architecture", "component", "utility", "tailwind", "responsive", "design",
            "canvas", "element", "style", "script", "terminal", "project", "source", "module"
        ];
        
        // DOM Elements
        const textDisplay = document.getElementById('text-display');
        const inputField = document.getElementById('input-field');
        const typingInterface = document.getElementById('typing-interface');
        const resultsInterface = document.getElementById('results-interface');
        const restartButton = document.getElementById('restart-button');
        const restartButtonResults = document.getElementById('restart-button-results');
        const resultsBreakdown = document.getElementById('results-breakdown');
        const correctCountDisplay = document.getElementById('correct-count');
        const totalCountDisplay = document.getElementById('total-count-display');
        
        let shuffledWords = [];
        let currentWordIndex = 0;
        let results = []; // Stores { word: "...", correct: true/false, input: "..." }

        // --- Core Functions ---

        function setupTest() {
            // Shuffle and slice a set of words for the test (25 words)
            shuffledWords = [...WORDS].sort(() => 0.5 - Math.random()).slice(0, 25);
            currentWordIndex = 0;
            results = [];
            
            // UI setup
            inputField.value = '';
            inputField.disabled = false;
            typingInterface.classList.remove('hidden');
            resultsInterface.classList.add('hidden');
            
            // Set initial focus
            inputField.focus();
            
            renderTextDisplay();
        }

        function renderTextDisplay() {
            textDisplay.innerHTML = ''; // Clear previous content
            
            shuffledWords.forEach((word, index) => {
                const wordSpan = document.createElement('span');
                wordSpan.textContent = word + ' '; // Add space for separation

                if (index < currentWordIndex) {
                    // Word is already completed, determine correct/incorrect class
                    const result = results.find(r => r.word === word);
                    if (result) {
                        wordSpan.classList.add(result.correct ? 'correct' : 'incorrect');
                    }
                } else if (index === currentWordIndex) {
                    // Current word to be typed
                    wordSpan.classList.add('current', 'text-gray-900');
                    
                    // Highlight letters based on current input
                    const currentInput = inputField.value;
                    wordSpan.innerHTML = ''; // Clear temporary text
                    
                    for (let i = 0; i < word.length; i++) {
                        const letterSpan = document.createElement('span');
                        letterSpan.textContent = word[i];
                        
                        if (i < currentInput.length) {
                            if (currentInput[i] === word[i]) {
                                letterSpan.classList.add('text-green-600');
                            } else {
                                letterSpan.classList.add('incorrect-letter');
                            }
                        }
                        wordSpan.appendChild(letterSpan);
                    }
                    // If the user typed more than the word length, mark the extra input as incorrect
                    if (currentInput.length > word.length) {
                        const extraSpan = document.createElement('span');
                        extraSpan.textContent = currentInput.substring(word.length);
                        extraSpan.classList.add('incorrect-letter');
                        wordSpan.appendChild(extraSpan);
                    }
                    
                    wordSpan.appendChild(document.createTextNode(' ')); // Restore the trailing space
                    
                } else {
                    // Future words
                    wordSpan.classList.add('text-gray-500');
                }
                
                textDisplay.appendChild(wordSpan);
            });
            
            // Scroll the text to keep the current word visible
            const currentWordElement = textDisplay.querySelector('.current');
            if (currentWordElement) {
                const rect = currentWordElement.getBoundingClientRect();
                const containerRect = textDisplay.getBoundingClientRect();
                
                // Check if the current word is fully visible in the text display area
                if (rect.left < containerRect.left || rect.right > containerRect.right) {
                    // If not, scroll it into view
                    currentWordElement.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                }
            }
        }

        function handleSpacePress() {
            if (currentWordIndex >= shuffledWords.length) return; // Safety check
            
            const targetWord = shuffledWords[currentWordIndex];
            // Use trim() to handle any potential leading/trailing whitespace
            const typedText = inputField.value.trim(); 
            
            // 1. Determine correctness
            const isMatch = targetWord === typedText;

            // 2. Record the result
            results.push({
                word: targetWord,
                correct: isMatch,
                input: typedText
            });

            // 3. Move to the next word and reset input
            currentWordIndex++;
            inputField.value = '';
            
            // 4. Check if the test is finished
            if (currentWordIndex >= shuffledWords.length) {
                endTest();
            } else {
                // Continue the test
                renderTextDisplay();
            }
        }

        function endTest() {
            inputField.disabled = true;
            typingInterface.classList.add('hidden');
            resultsInterface.classList.remove('hidden');
            
            // Calculate and display main score
            const correctCount = results.filter(r => r.correct).length;
            const totalWords = shuffledWords.length;
            const correctPercentage = (correctCount / totalWords) * 100;
            
            const finalMessageElement = document.getElementById('final-message');
            
            let messageText;
            let emoji;
            let colorClass; // Tailwind class for coloring the text
            
            // Check if percentage is 70% or more
            if (correctPercentage >= 70) {
                messageText = 'Well done!';
                emoji = '🥳';
                colorClass = 'text-green-600';
            } else {
                messageText = 'Try again!';
                emoji = '😔';
                colorClass = 'text-red-600';
            }
            
            // Update the main heading with the dynamic message and score
            finalMessageElement.className = `text-3xl font-extrabold mb-4 ${colorClass}`;
            finalMessageElement.innerHTML = `${messageText} ${emoji} (${correctCount} / ${totalWords} correct)`;

            correctCountDisplay.textContent = correctCount;
            totalCountDisplay.textContent = totalWords;
            document.getElementById('total-words').textContent = totalWords;

            // Display detailed breakdown
            resultsBreakdown.innerHTML = '';
            results.forEach(item => {
                const resultDiv = document.createElement('div');
                resultDiv.classList.add('result-item');

                const statusLabel = document.createElement('span');
                statusLabel.textContent = item.correct ? 'CORRECT' : 'INCORRECT';
                statusLabel.classList.add('word-result-label', item.correct ? 'word-correct' : 'word-incorrect');

                const wordPair = document.createElement('div');
                
                // Add the target word
                const targetWordSpan = document.createElement('span');
                targetWordSpan.classList.add('font-semibold', 'text-gray-800');
                targetWordSpan.textContent = `Target: ${item.word}`;

                // Add the user input
                const inputWordSpan = document.createElement('span');
                inputWordSpan.classList.add('text-sm', 'ml-4', 'text-gray-600');
                if (!item.correct) {
                    // Only show typed input if it was wrong
                    inputWordSpan.textContent = `(Typed: ${item.input || '[Empty]'})`;
                }

                wordPair.appendChild(targetWordSpan);
                wordPair.appendChild(inputWordSpan);
                
                resultDiv.appendChild(wordPair);
                resultDiv.appendChild(statusLabel);
                resultsBreakdown.appendChild(resultDiv);
            });
        }
        
        // --- Event Listeners ---

        inputField.addEventListener('keydown', (event) => {
            // Prevent the default space behavior to avoid adding a space to the input field
            if (event.key === ' ') {
                event.preventDefault();
            }
        });

        inputField.addEventListener('keyup', (event) => {
            if (currentWordIndex >= shuffledWords.length) return; // Ignore input if test is over

            // Check for Spacebar press to trigger word completion/move
            if (event.key === ' ') {
                handleSpacePress();
            } else {
                // Update highlighting as user types
                renderTextDisplay();
            }
        });

        restartButton.addEventListener('click', setupTest);
        restartButtonResults.addEventListener('click', setupTest);

        // --- Initialization ---
        window.onload = setupTest;
    </script>
</body>
</html>
